import { Ddu64, DduSetSymbol } from "../index.js";

console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
console.log("â•‘            DDU ENIGMA - ë¹ ë¥¸ ê²€ì¦ í…ŒìŠ¤íŠ¸                                  â•‘");
console.log("â•‘            (ì£¼ìš” ê¸°ëŠ¥ë§Œ ë¹ ë¥´ê²Œ í…ŒìŠ¤íŠ¸)                                    â•‘");
console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

// í…ŒìŠ¤íŠ¸ í†µê³„
let totalTests = 0;
let passedTests = 0;
let failedTests = 0;

function reportTest(name: string, passed: boolean, details?: string) {
  totalTests++;
  if (passed) {
    passedTests++;
    console.log(`  âœ“ ${name}`);
  } else {
    failedTests++;
    console.log(`  âœ— ${name}${details ? ` - ${details}` : ""}`);
  }
}

const BASE64_CHARS = [
  "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P",
  "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z", "a", "b", "c", "d", "e", "f",
  "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v",
  "w", "x", "y", "z", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "+", "/",
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("[ 1. ê¸°ë³¸ ì¸ì½”ë”©/ë””ì½”ë”© ]");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

{
  const encoder = new Ddu64(BASE64_CHARS, "=");
  const testCases = [
    { name: "ì˜ë¬¸", data: "Hello World!" },
    { name: "í•œê¸€", data: "ì•ˆë…•í•˜ì„¸ìš”" },
    { name: "í˜¼í•©", data: "Helloì•ˆë…•123!ğŸ˜€" },
  ];

  testCases.forEach(test => {
    try {
      const encoded = encoder.encode(test.data);
      const decoded = encoder.decode(encoded);
      reportTest(test.name, test.data === decoded);
    } catch (err: any) {
      reportTest(test.name, false, err.message);
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("[ 2. ë©€í‹°ë°”ì´íŠ¸ ë¹„ 2ì˜ ì œê³±ìˆ˜ charset ]");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

{
  console.log("í•œê¸€ 3ê°œ charset:");
  try {
    const encoder = new Ddu64("ìš°ë”°ì•¼", "ë­", { usePowerOfTwo: false });
    const testData = "ì•ˆë…•í•˜ì„¸ìš” Hello!";
    const encoded = encoder.encode(testData);
    const decoded = encoder.decode(encoded);
    reportTest("í•œê¸€ 3ê°œ charset", testData === decoded);
  } catch (err: any) {
    reportTest("í•œê¸€ 3ê°œ charset", false, err.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("[ 3. ì¤‘ë³µ ë¬¸ì ê²€ì¦ ]");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

{
  try {
    new Ddu64("ìš°ë”°ì•¼ì•¼", "ë­", { useBuildErrorReturn: true });
    reportTest("ì¤‘ë³µ ë¬¸ì ê°ì§€", false, "ì—ëŸ¬ê°€ ë°œìƒí•´ì•¼ í•¨");
  } catch (err: any) {
    reportTest("ì¤‘ë³µ ë¬¸ì ê°ì§€", err.message.includes("duplicate"));
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("[ 4. íŒ¨ë”© í˜•ì‹ ê²€ì¦ ]");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

{
  try {
    const encoder = new Ddu64("ìš°ë”°ì•¼ì–´", "ë­");
    encoder.decode("ìš°ë”°ë­-5");
    reportTest("ìŒìˆ˜ íŒ¨ë”© ê°ì§€", false, "ì—ëŸ¬ê°€ ë°œìƒí•´ì•¼ í•¨");
  } catch (err: any) {
    reportTest("ìŒìˆ˜ íŒ¨ë”© ê°ì§€", err.message.includes("Invalid padding"));
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("[ 5. ë‹¤ì–‘í•œ charset í¬ê¸° ]");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

{
  // 2ì˜ ì œê³±ìˆ˜
  try {
    const chars = Array.from({ length: 64 }, (_, i) => String.fromCharCode(0x4E00 + i));
    const encoder = new Ddu64(chars, "ë­");
    const testData = "64ê°œ charset";
    const encoded = encoder.encode(testData);
    const decoded = encoder.decode(encoded);
    reportTest("64ê°œ (2^6)", testData === decoded);
  } catch (err: any) {
    reportTest("64ê°œ (2^6)", false, err.message);
  }

  // ë¹„ 2ì˜ ì œê³±ìˆ˜
  try {
    const chars = Array.from({ length: 100 }, (_, i) => String.fromCharCode(0x5000 + i));
    const encoder = new Ddu64(chars, "ë­", { usePowerOfTwo: false });
    const testData = "100ê°œ charset";
    const encoded = encoder.encode(testData);
    const decoded = encoder.decode(encoded);
    reportTest("100ê°œ (ë¹„ 2ì˜ ì œê³±ìˆ˜)", testData === decoded);
  } catch (err: any) {
    reportTest("100ê°œ (ë¹„ 2ì˜ ì œê³±ìˆ˜)", false, err.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("[ 6. ë°”ì´ë„ˆë¦¬ ë°ì´í„° (decodeToBuffer) ]");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

{
  const encoder = new Ddu64(BASE64_CHARS, "=", { encoding: 'latin1' });
  
  // 0xFF ë°”ì´íŠ¸
  try {
    const buffer = Buffer.alloc(50, 0xFF);
    const encoded = encoder.encode(buffer);
    const decodedBuffer = encoder.decodeToBuffer(encoded);
    reportTest("ëª¨ë“  0xFF ë°”ì´íŠ¸", buffer.equals(decodedBuffer));
  } catch (err: any) {
    reportTest("ëª¨ë“  0xFF ë°”ì´íŠ¸", false, err.message);
  }

  // ë°˜ë³µ íŒ¨í„´
  try {
    const buffer = Buffer.from([0xAA, 0x55].flatMap(b => Array(25).fill(b)));
    const encoded = encoder.encode(buffer);
    const decodedBuffer = encoder.decodeToBuffer(encoded);
    reportTest("ë°˜ë³µ íŒ¨í„´ (0xAA, 0x55)", buffer.equals(decodedBuffer));
  } catch (err: any) {
    reportTest("ë°˜ë³µ íŒ¨í„´ (0xAA, 0x55)", false, err.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("[ 7. ì—ëŸ¬ ë©”ì‹œì§€ í‘œì¤€í™” ]");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

{
  try {
    new Ddu64("ABC", undefined as any, { useBuildErrorReturn: true });
    reportTest("ì—ëŸ¬ ë©”ì‹œì§€ ì ‘ë‘ì‚¬", false, "ì—ëŸ¬ê°€ ë°œìƒí•´ì•¼ í•¨");
  } catch (err: any) {
    reportTest("ì—ëŸ¬ ë©”ì‹œì§€ ì ‘ë‘ì‚¬", err.message.includes("[Ddu64 Constructor]"));
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("[ 8. getCharSetInfo ë©”ì„œë“œ ]");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

{
  try {
    const encoder = new Ddu64(BASE64_CHARS, "=");
    const info = encoder.getCharSetInfo();
    
    const passed = 
      info.charSet.length === 64 &&
      info.paddingChar === "=" &&
      info.bitLength === 6 &&
      info.usePowerOfTwo === true;
    
    reportTest("getCharSetInfo", passed);
  } catch (err: any) {
    reportTest("getCharSetInfo", false, err.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("[ 9. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ]");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

{
  // ëŒ€ìš©ëŸ‰ ë°ì´í„°
  try {
    const encoder = new Ddu64(BASE64_CHARS, "=");
    const testData = "A".repeat(10000);
    const encoded = encoder.encode(testData);
    const decoded = encoder.decode(encoded);
    reportTest("10KB ë°ì´í„°", testData === decoded);
  } catch (err: any) {
    reportTest("10KB ë°ì´í„°", false, err.message);
  }

  // ë°˜ë³µ í…ŒìŠ¤íŠ¸
  try {
    const encoder = new Ddu64("ìš°ë”°ì•¼", "ë­", { usePowerOfTwo: false });
    const testData = "ë°˜ë³µ";
    let allPassed = true;
    
    for (let i = 0; i < 100; i++) {
      const encoded = encoder.encode(testData);
      const decoded = encoder.decode(encoded);
      if (decoded !== testData) {
        allPassed = false;
        break;
      }
    }
    
    reportTest("100íšŒ ë°˜ë³µ", allPassed);
  } catch (err: any) {
    reportTest("100íšŒ ë°˜ë³µ", false, err.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("[ ìµœì¢… ê²°ê³¼ ]");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

const successRate = ((passedTests / totalTests) * 100).toFixed(1);

console.log(`ì´ í…ŒìŠ¤íŠ¸: ${totalTests}ê°œ`);
console.log(`í†µê³¼: ${passedTests}ê°œ (${successRate}%)`);
console.log(`ì‹¤íŒ¨: ${failedTests}ê°œ\n`);

if (failedTests === 0) {
  console.log("âœ… ëª¨ë“  ì£¼ìš” ê¸°ëŠ¥ ì •ìƒ ì‘ë™!\n");
  console.log("ğŸ’¡ ì „ì²´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´:");
  console.log("   npx tsx ./src/test/test-all-integrated.ts");
  console.log("   ë˜ëŠ”");
  console.log("   npx tsx ./src/test/test-comprehensive.ts\n");
} else {
  console.log(`âŒ ${failedTests}ê°œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨\n`);
  process.exit(1);
}

console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
console.log("â•‘                       ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!                                    â•‘");
console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

